<div class="popup-overlay" *ngIf="isOpen" (click)="onOverlayClick($event)">
    <div class="popup-container">
        <div class="popup-header">
            <h2>Edit Profile</h2>
            <button class="close-btn" (click)="onClose()">
                <span>âœ•</span>
            </button>
        </div>

        <div class="popup-body">
            <!-- Avatar Upload -->
            <div class="avatar-section">
                <div class="avatar-wrapper">
                    <img [src]="avatarPreview || currentProfile?.avatarUrl || 'https://ui-avatars.com/api/?name=User&background=3b82f6&color=fff'"
                        [alt]="name" class="avatar-preview" />
                </div>
                <button type="button" class="change-photo-btn" (click)="avatarInput.click()">
                    ðŸ“· Change Photo
                </button>
                <input #avatarInput type="file" class="avatar-input" accept="image/*"
                    (change)="onAvatarSelected($event)" />
            </div>

            <!-- Form Fields -->
            <div class="form-group">
                <label for="name">Display Name</label>
                <input type="text" id="name" [(ngModel)]="name" placeholder="Enter your display name" maxlength="50" />
            </div>

            <div class="form-group">
                <label for="bio">Bio</label>
                <textarea id="bio" [(ngModel)]="bio" placeholder="Tell us about yourself..." rows="4"
                    maxlength="200"></textarea>
                <span class="char-count">{{ bio.length }}/200</span>
            </div>

            <!-- Error Message -->
            <div class="error-message" *ngIf="errorMessage()">
                {{ errorMessage() }}
            </div>
        </div>

        <div class="popup-footer">
            <button class="btn-cancel" (click)="onClose()">Cancel</button>
            <button class="btn-save" (click)="onSave()" [disabled]="isLoading()">
                <span *ngIf="isLoading()">Saving...</span>
                <span *ngIf="!isLoading()">Save Changes</span>
            </button>
        </div>
    </div>
</div>