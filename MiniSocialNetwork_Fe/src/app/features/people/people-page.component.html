<div class="people-page">
    <!-- Error Message -->
    @if (error()) {
    <div class="error-message">
        <p>‚ö†Ô∏è {{ error() }}</p>
        <button (click)="refresh()">Retry</button>
    </div>
    }

    <!-- Search & Filter Section -->
    <section class="search-filter-section">
        <div class="search-bar">
            <span class="search-icon">üîç</span>
            <input type="text" placeholder="T√¨m ki·∫øm theo t√™n ho·∫∑c username..." [ngModel]="searchQuery()"
                (ngModelChange)="onSearchChange($event)" />
            @if (searchQuery()) {
            <button class="clear-btn" (click)="onSearchChange('')">‚úï</button>
            }
        </div>

        <div class="filter-tabs">
            <button class="filter-tab" [class.active]="filterMode() === 'all'" (click)="setFilterMode('all')">
                <span class="tab-icon">üë•</span>
                T·∫•t c·∫£
                <span class="tab-count">{{ allUsers().length }}</span>
            </button>
            <button class="filter-tab" [class.active]="filterMode() === 'following'"
                (click)="setFilterMode('following')">
                <span class="tab-icon">‚úì</span>
                ƒê√£ follow
                <span class="tab-count">{{ following().length }}</span>
            </button>
            <button class="filter-tab" [class.active]="filterMode() === 'not-following'"
                (click)="setFilterMode('not-following')">
                <span class="tab-icon">+</span>
                Ch∆∞a follow
                <span class="tab-count">{{ suggestions().length }}</span>
            </button>
        </div>
    </section>

    <!-- Filtered Results Section (shown when searching or filtering) -->
    @if (searchQuery() || filterMode() !== 'all') {
    <section class="user-section filtered-results-section">
        <div class="section-header">
            <h2>
                <span class="icon">üîé</span>
                K·∫øt qu·∫£ l·ªçc ({{ filteredResults().length }})
            </h2>
            @if (filteredResults().length > 0) {
            <div class="scroll-buttons">
                <button class="scroll-btn" (click)="scrollContainer('filtered', -320)">‚Äπ</button>
                <button class="scroll-btn" (click)="scrollContainer('filtered', 320)">‚Ä∫</button>
            </div>
            }
        </div>
        @if (filteredResults().length === 0) {
        <div class="empty-state">
            <p>üîç Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng ph√π h·ª£p.</p>
        </div>
        } @else {
        <div class="cards-container" id="filtered-container">
            @for (user of filteredResults(); track user.id) {
            <div class="user-card">
                <div class="card-header">
                    <img [src]="user.avatarUrl" [alt]="user.name" class="avatar" />
                    @if (user.followsYou) {
                    <span class="follows-you-badge">FOLLOWS YOU</span>
                    }
                </div>
                <div class="card-body">
                    <h3 class="name">{{ user.name }}</h3>
                    <span class="username">{{ user.username }}</span>
                    <p class="bio">{{ user.bio }}</p>
                    <div class="stats">
                        <div class="stat">
                            <span class="stat-value">{{ user.followersCount }}</span>
                            <span class="stat-label">FOLLOWERS</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">{{ user.followingCount }}</span>
                            <span class="stat-label">FOLLOWING</span>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <div class="action-buttons">
                        <button class="follow-btn" [class.following]="user.isFollowing"
                            (click)="toggleFollowInResults(user)" [disabled]="isLoading()">
                            <span class="btn-icon">{{ user.isFollowing ? '‚úì' : '+' }}</span>
                            {{ user.isFollowing ? 'Unfollow' : 'Follow' }}
                        </button>
                        <button class="message-btn" (click)="openChat(user)">
                            <span class="btn-icon">üí¨</span>
                        </button>
                    </div>
                </div>
            </div>
            }
        </div>
        }
    </section>
    } @else {

    <!-- Suggested for you Section (First) -->
    <section class="user-section">
        <div class="section-header">
            <h2><span class="icon">‚ú®</span> Suggested for you</h2>
            @if (suggestions().length > 0) {
            <div class="scroll-buttons">
                <button class="scroll-btn" (click)="scrollContainer('suggestions', -320)">‚Äπ</button>
                <button class="scroll-btn" (click)="scrollContainer('suggestions', 320)">‚Ä∫</button>
            </div>
            }
        </div>
        @if (suggestions().length === 0) {
        <div class="empty-state">
            <p>üîç Kh√¥ng c√≥ ng∆∞·ªùi d√πng g·ª£i √Ω. B·∫°n ƒë√£ follow t·∫•t c·∫£ m·ªçi ng∆∞·ªùi!</p>
        </div>
        } @else {
        <div class="cards-container" id="suggestions-container">
            @for (user of suggestions(); track user.id) {
            <div class="user-card">
                <div class="card-header">
                    <img [src]="user.avatarUrl" [alt]="user.name" class="avatar" />
                    @if (user.followsYou) {
                    <span class="follows-you-badge">FOLLOWS YOU</span>
                    }
                </div>
                <div class="card-body">
                    <h3 class="name">{{ user.name }}</h3>
                    <span class="username">{{ user.username }}</span>
                    <p class="bio">{{ user.bio }}</p>
                    <div class="stats">
                        <div class="stat">
                            <span class="stat-value">{{ user.followersCount }}</span>
                            <span class="stat-label">FOLLOWERS</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">{{ user.followingCount }}</span>
                            <span class="stat-label">FOLLOWING</span>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <div class="action-buttons">
                        <button class="follow-btn" [class.following]="user.isFollowing"
                            (click)="toggleFollow(user, 'suggestions')" [disabled]="isLoading()">
                            <span class="btn-icon">{{ user.isFollowing ? '‚úì' : '+' }}</span>
                            {{ user.isFollowing ? 'Unfollow' : 'Follow' }}
                        </button>
                        <button class="message-btn" (click)="openChat(user)">
                            <span class="btn-icon">üí¨</span>
                        </button>
                    </div>
                </div>
            </div>
            }
        </div>
        }
    </section>


    <!-- Following Section (Second) -->
    <section class="user-section">
        <div class="section-header">
            <h2><span class="icon">üë§</span> Following ({{ following().length }})</h2>
            <div class="scroll-buttons">
                <button class="scroll-btn" (click)="scrollContainer('following', -320)">‚Äπ</button>
                <button class="scroll-btn" (click)="scrollContainer('following', 320)">‚Ä∫</button>
            </div>
        </div>
        @if (isFollowingLoading()) {
        <div class="loading-state">
            <p>Loading following...</p>
        </div>
        } @else if (following().length === 0) {
        <div class="empty-state">
            <p>You are not following anyone yet.</p>
        </div>
        } @else {
        <div class="cards-container" id="following-container">
            @for (user of following(); track user.id) {
            <div class="user-card">
                <div class="card-header">
                    <img [src]="user.avatarUrl" [alt]="user.name" class="avatar" />
                    @if (user.followsYou) {
                    <span class="follows-you-badge">FOLLOWS YOU</span>
                    }
                </div>
                <div class="card-body">
                    <h3 class="name">{{ user.name }}</h3>
                    <span class="username">{{ user.username }}</span>
                    <p class="bio">{{ user.bio }}</p>
                    <div class="stats">
                        <div class="stat">
                            <span class="stat-value">{{ user.followersCount }}</span>
                            <span class="stat-label">FOLLOWERS</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">{{ user.followingCount }}</span>
                            <span class="stat-label">FOLLOWING</span>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <div class="action-buttons">
                        <button class="follow-btn following" (click)="toggleFollow(user, 'following')"
                            [disabled]="isLoading()">
                            <span class="btn-icon">‚úì</span>
                            Unfollow
                        </button>
                        <button class="message-btn" (click)="openChat(user)">
                            <span class="btn-icon">üí¨</span>
                        </button>
                    </div>
                </div>
            </div>
            }
        </div>
        }
    </section>

    <!-- Your Followers Section (Third) -->
    <section class="user-section">
        <div class="section-header">
            <h2><span class="icon">üë•</span> Your Followers ({{ followers().length }})</h2>
            <div class="scroll-buttons">
                <button class="scroll-btn" (click)="scrollContainer('followers', -320)">‚Äπ</button>
                <button class="scroll-btn" (click)="scrollContainer('followers', 320)">‚Ä∫</button>
            </div>
        </div>
        @if (isFollowersLoading()) {
        <div class="loading-state">
            <p>Loading followers...</p>
        </div>
        } @else if (followers().length === 0) {
        <div class="empty-state">
            <p>You don't have any followers yet.</p>
        </div>
        } @else {
        <div class="cards-container" id="followers-container">
            @for (user of followers(); track user.id) {
            <div class="user-card">
                <div class="card-header">
                    <img [src]="user.avatarUrl" [alt]="user.name" class="avatar" />
                </div>
                <div class="card-body">
                    <h3 class="name">{{ user.name }}</h3>
                    <span class="username">{{ user.username }}</span>
                    <p class="bio">{{ user.bio }}</p>
                    <div class="stats">
                        <div class="stat">
                            <span class="stat-value">{{ user.followersCount }}</span>
                            <span class="stat-label">FOLLOWERS</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">{{ user.followingCount }}</span>
                            <span class="stat-label">FOLLOWING</span>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <div class="action-buttons">
                        <button class="follow-btn" [class.following]="user.isFollowing"
                            (click)="toggleFollow(user, 'followers')" [disabled]="isLoading()">
                            <span class="btn-icon">{{ user.isFollowing ? '‚úì' : '+' }}</span>
                            {{ user.isFollowing ? 'Unfollow' : 'Follow Back' }}
                        </button>
                        <button class="message-btn" (click)="openChat(user)">
                            <span class="btn-icon">üí¨</span>
                        </button>
                    </div>
                </div>
            </div>
            }
        </div>
        }
    </section>
    }
</div>