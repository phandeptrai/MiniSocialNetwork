<div class="conversation-list">
  <!-- Search bar -->
  <div class="search-container">
    <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="11" cy="11" r="8"></circle>
      <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
    </svg>
    <input type="text" placeholder="TÃ¬m kiáº¿m cuá»™c trÃ² chuyá»‡n..." class="search-input" [value]="searchQuery"
      (input)="onSearchChange($event)" />
    <button class="clear-search-btn" *ngIf="searchQuery" (click)="clearSearch()" title="XÃ³a tÃ¬m kiáº¿m">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>

  <!-- Loading state -->
  <div class="loading-container" *ngIf="isLoading$ | async">
    <div class="loading-spinner"></div>
    <span>Loading conversations...</span>
  </div>

  <!-- Empty state -->
  <div class="empty-state"
    *ngIf="!(isLoading$ | async) && (filteredConversations$ | async)?.length === 0 && !searchQuery">
    <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
    </svg>
    <p>No conversations yet</p>
    <button class="btn-start-chat" (click)="startNewConversation()">Start a new chat</button>
  </div>

  <!-- No search results -->
  <div class="no-results-state"
    *ngIf="!(isLoading$ | async) && (filteredConversations$ | async)?.length === 0 && searchQuery">
    <svg class="no-results-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
      <circle cx="11" cy="11" r="8"></circle>
      <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
      <line x1="8" y1="8" x2="14" y2="14"></line>
      <line x1="14" y1="8" x2="8" y2="14"></line>
    </svg>
    <p>KhÃ´ng tÃ¬m tháº¥y cuá»™c trÃ² chuyá»‡n nÃ o</p>
    <span class="search-hint">Thá»­ tÃ¬m kiáº¿m vá»›i tá»« khÃ³a khÃ¡c</span>
  </div>

  <!-- Conversation items -->
  <div class="conversations-wrapper">
    <div class="conversation-item" *ngFor="let conv of filteredConversations$ | async"
      [class.active]="(selectedConversation$ | async)?.id === conv.id" [class.unread]="hasUnread(conv.id)"
      (click)="selectConversation(conv)">

      <div class="avatar">
        <img *ngIf="conv.displayAvatarUrl" [src]="conv.displayAvatarUrl" [alt]="conv.displayName" class="avatar-img" />
        <div *ngIf="!conv.displayAvatarUrl" class="avatar-placeholder">
          {{ conv.displayName?.charAt(0)?.toUpperCase() || 'U' }}
        </div>
        <span class="online-indicator" *ngIf="conv.type === 'ONE_TO_ONE'"></span>
        <!-- Unread indicator (green dot) -->
        <span class="unread-indicator" *ngIf="hasUnread(conv.id)"></span>
      </div>

      <div class="conversation-info">
        <div class="conversation-header">
          <h4 class="conversation-name">{{ conv.displayName || conv.name || 'Unnamed' }}</h4>
          <span class="conversation-time">{{ conv.updatedAt | date:'shortTime' }}</span>
        </div>
        <p class="conversation-preview">
          <span *ngIf="conv.lastMessageType === 'IMAGE'">ðŸ“· Photo</span>
          <span *ngIf="conv.lastMessageType === 'FILE' || conv.lastMessageType === 'ATTACHMENT'">ðŸ“Ž Attachment</span>
          <span *ngIf="conv.lastMessageType === 'TEXT' || !conv.lastMessageType">
            {{ conv.lastMessageContent || 'No messages yet' }}
          </span>
        </p>
      </div>

      <div class="conversation-badge" *ngIf="conv.type === 'GROUP'">
        <svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
          <path
            d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-6 8c0-2.67 5.33-4 6-4s6 1.33 6 4v1H6v-1z" />
        </svg>
      </div>
    </div>
  </div>
</div>