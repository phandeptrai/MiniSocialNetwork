<article class="post-card" *ngIf="post">
  <!-- Header -->
  <header class="post-header">
    <div class="avatar">
      <img *ngIf="post.authorAvatarUrl; else defaultAvatar" [src]="post.authorAvatarUrl!" alt="avatar" />
      <ng-template #defaultAvatar>
        <div class="avatar-placeholder"></div>
      </ng-template>
    </div>
    <div class="meta">
      <div class="author">{{ post.authorName }}</div>
      <div class="time">{{ post.createdAt | date: 'shortTime' }}</div>
    </div>

    <!-- 3-dot menu (only for owner) -->
    <div class="menu-container" *ngIf="isOwner()">
      <button type="button" class="menu-button" (click)="toggleMenu($event)">
        ‚ãÆ
      </button>
      <div class="dropdown-menu" *ngIf="isMenuOpen()">
        <button type="button" class="dropdown-item" (click)="startEdit()">
          ‚úèÔ∏è Ch·ªânh s·ª≠a
        </button>
        <button type="button" class="dropdown-item delete" (click)="confirmDelete()">
          üóëÔ∏è X√≥a
        </button>
      </div>
    </div>
  </header>

  <!-- Content text (view mode) -->
  <p class="post-text" *ngIf="post.content && !isEditing()">
    {{ post.content }}
  </p>

  <!-- Content text (edit mode) -->
  <div class="edit-container" *ngIf="isEditing()">
    <textarea class="edit-textarea" [(ngModel)]="editedContent" rows="3" placeholder="N·ªôi dung b√†i vi·∫øt..."></textarea>
    <div class="edit-actions">
      <button type="button" class="btn-cancel" (click)="cancelEdit()">H·ªßy</button>
      <button type="button" class="btn-save" (click)="saveEdit()">L∆∞u</button>
    </div>
  </div>

  <!-- Images layout -->
  <div class="post-images" [ngSwitch]="imageCount()">
    <!-- 0 images: nothing -->

    <!-- 1 image -->
    <ng-container *ngSwitchCase="1">
      <div class="layout-1">
        <img [src]="post.imageUrls[0]" alt="post image" class="clickable-image" (click)="openLightbox(0)" />
      </div>
    </ng-container>

    <!-- 2 images -->
    <ng-container *ngSwitchCase="2">
      <div class="layout-2">
        <img *ngFor="let url of post.imageUrls; let i = index" [src]="url" alt="post image" class="clickable-image"
          (click)="openLightbox(i)" />
      </div>
    </ng-container>

    <!-- 3 images -->
    <ng-container *ngSwitchCase="3">
      <div class="layout-3">
        <div class="main">
          <img [src]="post.imageUrls[0]" alt="post image" class="clickable-image" (click)="openLightbox(0)" />
        </div>
        <div class="side">
          <img [src]="post.imageUrls[1]" alt="post image" class="clickable-image" (click)="openLightbox(1)" />
          <img [src]="post.imageUrls[2]" alt="post image" class="clickable-image" (click)="openLightbox(2)" />
        </div>
      </div>
    </ng-container>

    <!-- 4 images -->
    <ng-container *ngSwitchCase="4">
      <div class="layout-4">
        <img *ngFor="let url of post.imageUrls; let i = index" [src]="url" alt="post image" class="clickable-image"
          (click)="openLightbox(i)" />
      </div>
    </ng-container>
  </div>

  <!-- Image Lightbox -->
  <app-image-lightbox [images]="post.imageUrls || []" [isOpen]="isLightboxOpen()" [startIndex]="lightboxStartIndex"
    (closed)="closeLightbox()"></app-image-lightbox>

  <!-- Actions: like & comment counts -->
  <div class="post-actions">
    <button type="button" class="icon-button" [class.active]="internalIsLiked()"
      (click)="$event.preventDefault(); $event.stopPropagation(); onToggleLike()">
      ‚ù§Ô∏è
    </button>
    <span class="count">{{ internalLikeCount() }}</span>

    <button type="button" class="icon-button" (click)="onOpenComments()">
      üí¨
    </button>
    <span class="count">{{ internalCommentCount() }}</span>
  </div>

  <!-- Comment bar (click to open popup) -->
  <div class="comment-bar" (click)="onOpenComments()">
    <div class="comment-bar-avatar"></div>
    <div class="comment-bar-input">
      <span class="comment-placeholder">Write a comment...</span>
    </div>
  </div>
</article>